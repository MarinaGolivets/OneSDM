% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_gbif.R
\name{prepare_gbif_data}
\alias{prepare_gbif_data}
\title{Download and Process GBIF Occurrence Data}
\usage{
prepare_gbif_data(
  gbif_ids = NULL,
  model_dir = NULL,
  r_environ = ".Renviron",
  start_year = 1981L,
  boundaries = c(-180L, 180L, -90L, 90L),
  max_uncertainty = 10L,
  overwrite = FALSE,
  return_data = FALSE,
  verbose = TRUE
)
}
\arguments{
\item{gbif_ids}{\emph{(character or numeric)} A vector of one or more GBIF
taxon keys. When multiple IDs are supplied, data are combined across all keys.
If \code{NULL} (default), the function attempts to retrieve IDs from the
\code{onesdm_gbif_ids} option. \strong{Required}.}

\item{model_dir}{\emph{(character)} Path to the directory where model outputs
will be saved. A subdirectory named \code{data} is automatically created within this
directory to store processed species data. When modelling multiple species,
it is recommended to use a separate directory for each run to avoid overwriting
or mixing data files. This path can also be set via the \code{onesdm_model_dir}
option.  Default is \code{NULL}. \strong{Required}.}

\item{r_environ}{\emph{(character)} Path to an \code{.Renviron} file containing GBIF
credentials (default: ".Renviron"). The function uses
\code{\link[ecokit:check_gbif]{ecokit::check_gbif()}} to verify the presence of GBIF credentials. If the
\code{GBIF_USER}, \code{GBIF_PWD}, and \code{GBIF_EMAIL} environment variables are not set
in the current R session, \code{check_gbif} attempts to read them from the
specified \code{.Renviron} file. See \code{\link[ecokit:check_gbif]{ecokit::check_gbif()}} and
this
\href{https://docs.ropensci.org/rgbif/articles/gbif_credentials.html}{\code{rgbif} documentation}
for details on setting GBIF credentials. If \code{r_environ = NULL}, the path to
the \code{.Renviron} file is retrieved from the "\code{onesdm_r_environ}" option.}

\item{start_year}{\emph{(integer)} The starting year from which records are included.
The default is \code{1981L}, to match the temporal coverage of CHELSA climate data.
Can also be set via the "\code{onesdm_start_year}" option.}

\item{boundaries}{\emph{(numeric)} A vector of size 4 containing spatial boundaries
as (left, right, bottom, top) in decimal degrees (default:
\code{c(-180L, 180L, -90L, 90L)} for global extent). Can also be set via
\code{onesdm_gbif_boundaries} option.}

\item{max_uncertainty}{\emph{(numeric)} Maximum allowed spatial uncertainty in
kilometres. Default is \code{10L}. Can also be set via
\code{onesdm_gbif_max_uncertainty} option.}

\item{overwrite}{\emph{(logical)} If \code{TRUE}, overwrites existing cleaned GBIF data
file in the model directory. Default is \code{FALSE}. Can also be set via
\code{onesdm_gbif_overwrite} option.}

\item{return_data}{\emph{(logical)} If \code{TRUE}, returns the processed GBIF data as an
\code{sf} object in addition to saving it. Default is \code{FALSE}.}

\item{verbose}{\emph{(logical)} If \code{TRUE} (default), prints progress messages during
execution. Can also be set via the \code{onesdm_verbose} option. Default is \code{"TRUE"}.}
}
\value{
If \code{return_data} is \code{TRUE}, return the cleaned GBIF data as an \code{sf}
object. Otherwise, returns (invisibly) a named list with paths to the saved
GBIF data files:
\itemize{
\item \code{gbif_request}: Path to the saved GBIF request object
(\code{data/gbif_request.RData}).
\item \code{gbif_status}: Path to the saved GBIF status object
(\code{data/gbif_status.RData}).
\item \code{gbif_data_raw}: Path to the downloaded raw GBIF data
(\code{data/gbif_data_raw.zip}).
\item \code{gbif_data}: Path to the processed and cleaned GBIF data
(\code{data/gbif_data.RData}).
}
}
\description{
Downloads, filters, and processes occurrence records from the
Global Biodiversity Information Facility (\href{https://gbif.org/}{GBIF}) for
specified taxon keys (GBIF IDs). The function handles data requests,
downloading, cleaning, and conversion to an \code{sf} object, with optional
spatial and temporal filters, coordinate uncertainty thresholds, and
geographic boundary constraints.
}
\details{
The function performs the following steps:
\itemize{
\item Validates input parameters and environment.
\item Checks for existing processed data to avoid redundant downloads/requests.
\item Requests occurrence data from GBIF using the \code{rgbif} package, applying
filters for coordinates, geospatial issues, year, occurrence status, basis
of record, and spatial boundaries.
\item Downloads and reads the raw data, applying further cleaning:
\itemize{
\item Removes records with missing or low-precision coordinates.
\item Filters by spatial uncertainty and accepted taxonomic ranks.
\item Applies additional cleaning using the \code{CoordinateCleaner} package.
}
\item Converts the cleaned data to an \code{sf} object and saves it.
\item Function default arguments can be set globally using the \code{options()}
function. Users can set these options at the start of their R session to
avoid repeatedly specifying them in function calls. The following options
correspond to the function arguments:
\itemize{
\item \code{onesdm_gbif_ids}: \code{gbif_ids}
\item \code{onesdm_model_dir}: \code{model_dir}
\item \code{onesdm_gbif_verbose}: \code{verbose}
\item \code{onesdm_start_year}: \code{start_year}
\item \code{onesdm_r_environ}: \code{r_environ}
\item \code{onesdm_gbif_boundaries}: \code{boundaries}
\item \code{onesdm_gbif_max_uncertainty}: \code{max_uncertainty}
\item \code{onesdm_gbif_overwrite}: \code{overwrite}
}
\item Example of setting options:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{options(
  onesdm_gbif_ids = c("1234567", "7654321"),
  onesdm_model_dir = "path/to/model_dir",
  onesdm_gbif_verbose = TRUE,
  onesdm_start_year = 1981L,
  onesdm_r_environ = ".Renviron",
  onesdm_gbif_boundaries = c(-180L, 180L, -90L, 90L),
  onesdm_gbif_max_uncertainty = 10L,
  onesdm_gbif_overwrite = FALSE
)
}\if{html}{\out{</div>}}
}
}
\examples{
\dontrun{
prepare_gbif_data(
  gbif_ids = c("1234567", "7654321"), model_dir = "path/to/model_dir")
}

}
\author{
Ahmed El-Gabbas
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_osf.R
\name{get_climate_data}
\alias{get_climate_data}
\title{Download climate data files from the OneSDM OSF project}
\usage{
get_climate_data(
  climate_dir = NULL,
  resolution = 10L,
  climate_scenario = "current",
  climate_model = "current",
  year = "1981_2010",
  var_names = NULL,
  verbose = TRUE,
  sleep_time = 1L
)
}
\arguments{
\item{climate_dir}{Character. Destination directory where climate and land
use data files will be saved. Can be set via the "\code{onesdm_climate_dir}"
option. The same directory should be used in case of modelling multiple
species to ensure consistency. Default is \code{NULL}.}

\item{resolution}{Numeric. Spatial resolution. Valid values are 5, 10, or 20
for resolutions of approximately 5, 10, and 20 km (2.5, 5, and 10
arc-minutes) respectively. Can be set via the "\code{onesdm_resolution}" option.
Default is \code{10L}.}

\item{climate_scenario}{Character scalar. Climate scenario; one of \code{current},
\code{ssp126}, \code{ssp370}, \code{ssp585}. Default is \code{"current"}.}

\item{climate_model}{Character scalar. Abbreviation of Global Circulation
Models; one of \code{current}, \code{gfdl}, \code{ipsl}, \code{mpi}, \code{mri}, \code{ukesm1}. Default
is \code{"current"}.}

\item{year}{Character scalar. Time period; one of \verb{1981_2010}, \verb{2011_2040},
\verb{2041_2070}, \verb{2071_2100}. Default is \code{"1981_2010"}.}

\item{var_names}{Character vector of climate variable codes to download. See
\link{climate_data} for the list of valid climate variable names. Can be
set via the "\code{onesdm_var_names}" option. This parameter is \emph{required} and
cannot be \code{NULL}.}

\item{verbose}{Logical scalar. If \code{TRUE} (default), prints progress and
informative messages.}

\item{sleep_time}{Numeric scalar. Number of seconds to pause after
downloading files to avoid overwhelming the server. Default is \code{1L}.}
}
\value{
Returns invisibly a tibble with metadata of the downloaded climate
data files, including their local paths.
}
\description{
Downloads selected climate raster files (GeoTIFF) from the OneSDM Open
Science Framework (OSF) storage based on spatial resolution, climate
scenario, climate model, time period, and variable names. The function
validates inputs, locates the corresponding files in the OSF project, creates
local directories as needed, downloads the files, and verifies their
integrity.
}
\details{
\itemize{
\item The function filters the \link{climate_data} data to identify files
matching the requested parameter combination, ensures a single OSF directory,
lists files via the \code{osfr} package, and joins metadata to obtain download
links.
\item GeoTIFF files are downloaded, if not already available and valid, using
\code{\link[httr:GET]{httr::GET()}} (with a maximum timeout of 5 minutes per file) into a mirrored
subdirectory structure under the \code{climate_dir}. Output files follow the
pattern: \verb{<climate_dir>/res_<resolution>/1981_2010/var_name.tif} for current
climate, and \verb{<climate_dir>/res_<resolution>/<year>_<climate_scenario>_}
\verb{<climate_model>/var_name.tif} for future climate.
\item Each file is validated as a GeoTIFF using \code{\link[ecokit:check_tiff]{ecokit::check_tiff()}}. Failed
downloads are reported.
\item Input validation is strict; any invalid values, missing combinations, or
inconsistent OSF directory layouts will trigger informative errors.
}
}
\examples{
\dontrun{
  ecokit::load_packages(fs, terra)

  # Create a temporary directory for climate data
  tmp_dir <- fs::path_temp("onesdm_climate")
  fs::dir_create(tmp_dir)

  # |||||||||||||||||||||||||

  # Example usage of get_climate_data
  get_climate_data(
    climate_dir = tmp_dir,
    resolution = 20L,
    climate_scenario = "current",
    climate_model = "current",
    year = "1981_2010",
    var_names = c("bio1", "bio12"),
    verbose = TRUE)

  # List downloaded files in the subdirectory of combination of parameters
  print(list.dirs(tmp_dir))

  list_files <- list.files(
    fs::path(tmp_dir, "res_20", "1981_2010"), full.names = TRUE)
  print(list_files)

  # Load the downloaded files as a SpatRaster stack
  terra::rast(list_files)

  # |||||||||||||||||||||||||

  # Example using future climate data set using options to set defaults

  options(
    onesdm_climate_dir = tmp_dir, onesdm_resolution = 20L,
    onesdm_verbose = TRUE)
  get_climate_data(
    climate_scenario = "ssp585", climate_model = "ukesm1",
    year = "2071_2100", var_names = c("bio5", "bio6", "npp"))

  # List downloaded files in the subdirectory of combination of parameters
  print(list.dirs(tmp_dir))

  # Load the downloaded files as a SpatRaster stack
  list_files_future <- list.files(
    fs::path(tmp_dir, "res_20", "2071_2100_ssp585", "ukesm1"),
    recursive = TRUE, pattern = "\\\\.tif$", full.names = TRUE)

  print(list_files_future)

  # Load the downloaded files as a SpatRaster stack
  terra::rast(list_files_future)

  # |||||||||||||||||||||||||

  # Clean up temporary directory after use
  fs::dir_delete(tmp_dir)
}

}
\seealso{
\itemize{
\item \link{climate_data} for the metadata table used to resolve files.
\item \link[ecokit:chelsa_var_info]{ecokit::chelsa_var_info} and \href{https://chelsa-climate.org/}{CHELSA}
webpage for details on climatic variables description.
}
}
\author{
Ahmed El-Gabbas
}
